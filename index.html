<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escala de Férias – Portaria 2026</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; background:#eef1f3; }
    header { background:#1abc9c; padding:15px; color:white; text-align:center; font-size:22px; font-weight:bold; }

    .container { padding: 20px; }

    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
    }

    .card {
        background:#ffffff;
        border-radius:12px;
        padding:18px;
        box-shadow:0 4px 10px rgba(0,0,0,0.08);
        border-left:5px solid #1abc9c;
        transition:0.3s;
    }

    .card.full { border-left:5px solid #e74c3c; background:#fff5f5; }

    .card:hover { transform: scale(1.02); }

    .month-title { font-size:20px; font-weight:bold; color:#2c3e50; margin-bottom:8px; }

    .limit { font-size:15px; margin-bottom:8px; color:#34495e; }

    .full-text { color:#e74c3c; font-weight:bold; }

    .user-list { font-size:14px; margin-top:10px; }
    .user-list div { background:#dff9f3; padding:6px; margin-bottom:5px; border-radius:5px; border-left:3px solid #1abc9c; }

    .form-box {
        background:white;
        margin-top:25px;
        padding:22px;
        border-radius:12px;
        box-shadow:0 4px 10px rgba(0,0,0,0.08);
    }

    .form-box input, .form-box select {
        width:100%;
        padding:10px;
        margin-bottom:12px;
        border-radius:6px;
        border:1px solid #ccc;
    }

    .btn { background:#1abc9c; padding:10px 20px; color:white; border:none; border-radius:8px; cursor:pointer; width:100%; font-size:16px; }
    .btn:hover { background:#159a80; }

    .adm-btn { background:#34495e; margin-top:10px; }
    .adm-btn:hover { background:#2c3e50; }
</style>
</head>
<body>
<header>Escala de Férias – Portaria 2026</header>
<div class="container">

<div class="card-grid" id="meses"></div>

<div class="form-box">
    <h2>Registrar Preferência</h2>
    <input id="nome" placeholder="Nome completo" required>
    <input id="cpf" placeholder="CPF" required>

    <label>1ª opção</label>
    <select id="m1"></select>

    <label>2ª opção</label>
    <select id="m2"></select>

    <label>3ª opção</label>
    <select id="m3"></select>

    <button class="btn" onclick="salvar()">Enviar</button>
    <button class="adm-btn btn" onclick="abrirADM()">Painel ADM</button>
</div>

<div id="admPanel" style="display:none; margin-top:20px;" class="form-box">
    <h2>Painel ADM</h2>
    <p>Digite a senha:</p>
    <input type="password" id="admPass">
    <button class="btn" onclick="validarADM()">Entrar</button>

    <div id="admContent" style="display:none; margin-top:20px;">
        <h3>Remover Registro</h3>
        <div id="admList"></div>
    </div>
</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyF35LglhpnXZPAX-nssi5Hzz90_lsjv6fjFScHWdQgBP6mAK8vuBrgQ5kF8ChgMzzk/exec";
const senhaADM = "lig@457812#";

const mesesNome = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

function carregarMesesSelect() {
    ["m1","m2","m3"].forEach(id => {
        let s = document.getElementById(id);
        mesesNome.forEach(m => {
            let op = document.createElement("option");
            op.value = m;
            op.textContent = m;
            s.appendChild(op);
        });
    });
}

async function carregarDashboard() {
    let res = await fetch(`${API}?action=read`);
    let json = await res.json();

    let dados = json.data;
    let meses = {};
    mesesNome.forEach(m => meses[m] = []);

    dados.forEach((l,i)=>{
        meses[l[2]]?.push(l[0]);
        meses[l[3]]?.push(l[0]);
        meses[l[4]]?.push(l[0]);
    });

    let area = document.getElementById("meses");
    area.innerHTML = "";

    mesesNome.forEach(m => {
        const lista = meses[m];
        let limit = lista.length;
        let full = limit >= 3 ? "full" : "";

        let div = document.createElement("div");
        div.className = `card ${full}`;
        div.innerHTML = `
            <div class='month-title'>${m}</div>
            <div class='limit'>${limit}/3 vagas</div>
            <div class='user-list'>${lista.map(n => `<div>${n}</div>`).join('')}</div>
        `;
        area.appendChild(div);
    });
}

async function salvar() {
    let nome = document.getElementById("nome").value;
    let cpf = document.getElementById("cpf").value;
    let m1 = document.getElementById("m1").value;
    let m2 = document.getElementById("m2").value;
    let m3 = document.getElementById("m3").value;

    if (!nome || !cpf) return alert("Nome e CPF são obrigatórios!");

    await fetch(`${API}?action=write&nome=${encodeURIComponent(nome)}&cpf=${cpf}&mes1=${m1}&mes2=${m2}&mes3=${m3}`);

    alert("Registrado com sucesso!");
    carregarDashboard();
}

function abrirADM(){ document.getElementById("admPanel").style.display="block"; }

async function validarADM(){
    let p = document.getElementById("admPass").value;
    if(p !== senhaADM) return alert("Senha incorreta!");

    document.getElementById("admContent").style.display="block";
    let res = await fetch(`${API}?action=read`);
    let json = await res.json();
    let dados = json.data;

    let a = document.getElementById("admList");
    a.innerHTML = "";
    dados.forEach((l,i)=>{
        let div = document.createElement("div");
        div.innerHTML = `${i+2} - ${l[0]} (${l[1]}) <button onclick='del(${i+2})'>Excluir</button>`;
        a.appendChild(div);
    });
}

async function del(linha){
    await fetch(`${API}?action=delete&linha=${linha}`);
    alert("Removido!");
    validarADM();
    carregarDashboard();
}

carregarMesesSelect();
carregarDashboard();
</script>
</body>
</html>
