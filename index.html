<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Férias - HVS</title>
<style>
    body { font-family: Arial; margin: 20px; }
    .full { color: red; font-weight: bold; }
    .hidden { display: none; }
    table { border-collapse: collapse; width: 500px; margin-top: 20px; }
    table, th, td { border: 1px solid #333; padding: 8px; }
</style>
</head>
<body>

<h2>Escolha de Férias - Equipe Portaria & Segurança</h2>

<div id="userSection">

    <label>Nome completo (obrigatório):</label><br>
    <input type="text" id="nome" required style="width: 300px;"><br><br>

    <label>Escolha até 3 meses para preferência de férias:</label><br><br>

    <div id="mesesContainer"></div>

    <br>
    <button onclick="salvarEscolha()">Enviar</button>

    <p id="msg"></p>

</div>

<hr>

<h3>Acesso do Administrador</h3>

<input type="password" id="senhaAdmin" placeholder="Senha do administrador">
<button onclick="loginAdmin()">Entrar</button>

<div id="adminPanel" class="hidden">
    <h3>Painel Administrativo</h3>

    <button onclick="resetarDados()">Resetar Todos os Dados</button>
    <button onclick="exportar()">Exportar Dados</button>

    <h3>Escala Atual</h3>
    <div id="tabelaAdmin"></div>
</div>

<script>
const ADMIN_PASSWORD = "lig@457812#"; // SUA SENHA AQUI
let dados = JSON.parse(localStorage.getItem("feriasDados") || "{}");

const meses = [
    "Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho",
    "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
];

function atualizarExibicaoMeses() {
    let container = document.getElementById("mesesContainer");
    container.innerHTML = "";

    meses.forEach((mes, i) => {
        let count = Object.values(dados).filter(v => v.includes(i)).length;
        let cheio = count >= 3 ? " (LOTADO)" : "";
        let disabled = count >= 3 ? "disabled" : "";

        container.innerHTML += `
            <label class="${count>=3?'full':''}">
                <input type="checkbox" value="${i}" class="mesCheck" ${disabled}>
                ${mes}${cheio}
            </label><br>
        `;
    });
}

function salvarEscolha() {
    let nome = document.getElementById("nome").value.trim();
    if (!nome) {
        document.getElementById("msg").innerHTML = "⚠️ O nome é obrigatório!";
        return;
    }

    let checks = [...document.querySelectorAll(".mesCheck:checked")].map(x => Number(x.value));

    if (checks.length !== 3) {
        document.getElementById("msg").innerHTML = "⚠️ Você deve escolher exatamente 3 meses.";
        return;
    }

    dados[nome] = checks;
    localStorage.setItem("feriasDados", JSON.stringify(dados));

    document.getElementById("msg").innerHTML = "✅ Dados enviados com sucesso!";
    atualizarExibicaoMeses();
}

function loginAdmin() {
    let senha = document.getElementById("senhaAdmin").value;

    if (senha === ADMIN_PASSWORD) {
        document.getElementById("adminPanel").classList.remove("hidden");
        gerarTabela();
    } else {
        alert("Senha incorreta!");
    }
}

function gerarTabela() {
    let tabela = `<table><tr><th>Colaborador</th><th>Meses Escolhidos</th></tr>`;
    for (let nome in dados) {
        let mesesEscolhidos = dados[nome].map(i => meses[i]).join(", ");
        tabela += `<tr><td>${nome}</td><td>${mesesEscolhidos}</td></tr>`;
    }
    tabela += "</table>";
    document.getElementById("tabelaAdmin").innerHTML = tabela;
}

function resetarDados() {
    if (confirm("Tem certeza que deseja apagar tudo?")) {
        dados = {};
        localStorage.removeItem("feriasDados");
        gerarTabela();
        atualizarExibicaoMeses();
        alert("Dados resetados!");
    }
}

function exportar() {
    let conteudo = "Nome,Mês 1,Mês 2,Mês 3\n";
    for (let nome in dados) {
        let linha = [nome, ...dados[nome].map(i => meses[i])].join(",");
        conteudo += linha + "\n";
    }

    let blob = new Blob([conteudo], { type: "text/csv" });
    let url = URL.createObjectURL(blob);

    let a = document.createElement("a");
    a.href = url;
    a.download = "ferias.csv";
    a.click();
}

atualizarExibicaoMeses();

</script>

</body>
</html>
